<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Patient Portal - Dr. Smith's Orthopedic Care</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 1rem;
        }
        
        .navbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 0;
            margin-bottom: 2rem;
            border-bottom: 1px solid #e2e8f0;
        }
        
        .logo {
            font-size: 1.5rem;
            font-weight: bold;
            color: #2c5282;
        }
        
        .nav-links {
            display: flex;
            gap: 1.5rem;
        }
        
        .nav-link {
            color: #4a5568;
            text-decoration: none;
            transition: color 0.3s;
        }
        
        .nav-link:hover {
            color: #2c5282;
        }
        
        .nav-link.active {
            color: #2c5282;
            font-weight: 600;
        }
        
        .user-info {
            color: #4a5568;
            font-weight: 500;
        }
        
        .banner {
            background-color: #2c5282;
            color: white;
            padding: 3rem 2rem;
            border-radius: 10px;
            margin-bottom: 2rem;
            background-image: linear-gradient(135deg, #2c5282, #4299e1);
        }
        
        .banner h1 {
            font-size: 2.5rem;
            margin-bottom: 1rem;
        }
        
        .banner p {
            font-size: 1.1rem;
            max-width: 600px;
            margin-bottom: 1.5rem;
        }
        
        .btn {
            background-color: #3182ce;
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1rem;
            transition: background-color 0.3s;
            text-decoration: none;
            display: inline-block;
        }
        
        .btn:hover {
            background-color: #2c5282;
        }
        
        .btn-outline {
            background-color: transparent;
            border: 2px solid white;
        }
        
        .btn-outline:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }
        
        .content-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 2rem;
        }
        
        .doctor-info, .location-info, .appointment-card, .status-card {
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            padding: 1.5rem;
            margin-bottom: 2rem;
        }
        
        .section-title {
            color: #2c5282;
            margin-bottom: 1rem;
            font-size: 1.5rem;
        }
        
        .doctor-info img {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            object-fit: cover;
            float: left;
            margin-right: 1.5rem;
            margin-bottom: 1rem;
        }
        
        .doctor-info p {
            margin-bottom: 1rem;
        }
        
        .doctor-info-content {
            overflow: hidden;
        }
        
        .location-map {
            width: 100%;
            height: 300px;
            border-radius: 8px;
            margin-bottom: 1rem;
        }
        
        .location-info p {
            margin-bottom: 0.5rem;
        }
        
        .status-label {
            display: inline-block;
            padding: 0.4rem 0.8rem;
            border-radius: 4px;
            font-size: 0.875rem;
            font-weight: 500;
            margin-bottom: 1rem;
        }
        
        .status-pending {
            background-color: #feebc8;
            color: #c05621;
        }
        
        .status-upcoming {
            background-color: #c6f6d5;
            color: #2f855a;
        }
        
        .status-in-treatment {
            background-color: #bee3f8;
            color: #2c5282;
        }
        
        .status-treated {
            background-color: #e9d8fd;
            color: #6b46c1;
        }
        
        .appointment-list {
            list-style: none;
        }
        
        .appointment-item {
            padding: 1rem;
            border-left: 3px solid #3182ce;
            background-color: #f8fafc;
            margin-bottom: 1rem;
        }
        
        .appointment-date {
            font-weight: 600;
            color: #2c5282;
            margin-bottom: 0.5rem;
        }
        
        .form-container {
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            padding: 2rem;
            max-width: 700px;
            margin: 2rem auto;
            display: none;
        }
        
        .form-container h2 {
            color: #2c5282;
            margin-bottom: 1.5rem;
            text-align: center;
        }
        
        .form-group {
            margin-bottom: 1.5rem;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            color: #4a5568;
            font-weight: 500;
        }
        
        .form-group input, 
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #cbd5e0;
            border-radius: 5px;
            font-size: 1rem;
        }
        
        .form-group textarea {
            min-height: 100px;
            resize: vertical;
        }
        
        .slot-selection {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1rem;
            margin-top: 1rem;
        }
        
        .slot-option {
            border: 1px solid #cbd5e0;
            padding: 0.75rem;
            border-radius: 5px;
            cursor: pointer;
            text-align: center;
        }
        
        .slot-option:hover {
            border-color: #3182ce;
        }
        
        .slot-option.selected {
            background-color: #ebf8ff;
            border-color: #3182ce;
            color: #2c5282;
        }
        
        .hidden {
            display: none;
        }
        
        .form-actions {
            display: flex;
            justify-content: flex-end;
            gap: 1rem;
        }
        
        .treatment-details {
            margin-top: 1.5rem;
        }
        
        .treatment-details h3 {
            font-size: 1.2rem;
            color: #4a5568;
            margin-bottom: 0.5rem;
        }
        
        .treatment-details p {
            margin-bottom: 0.5rem;
        }
        
        .logout-btn {
            background-color: #e53e3e;
        }
        
        .logout-btn:hover {
            background-color: #c53030;
        }
    </style>
</head>
<body>
    <div class="container">
        <nav class="navbar">
            <div class="logo">Dr. Smith's Orthopedic Care</div>
            <div class="nav-links">
                <a href="patient-homepage.html" class="nav-link active">Home</a>
                <a href="patient-appointment.html" class="nav-link" id="appointmentsLink">My Appointments</a>
                <a href="patient-treatment.html" class="nav-link" id="treatmentLink">Treatment</a>
            </div>
            <div class="user-info">
                Welcome, <span id="patientName">Guest</span>
                <button class="btn logout-btn" style="margin-left: 10px; padding: 0.3rem 0.6rem; font-size: 0.8rem;" id="logoutBtn">Logout</button>
            </div>
        </nav>
        
        <div class="banner">
            <h1>Specialized Orthopedic Care</h1>
            <p>Experience expert orthopedic treatment with Dr. Smith, specializing in sports injuries, joint pain, and rehabilitation therapies.</p>
            <a href="patient-appointment.html" class="btn" id="bookAppointmentBtn">Book an Appointment</a>
            <a href="#" class="btn btn-outline">Learn About Services</a>
        </div>
        
        <div class="content-grid">
            <div class="main-content">
                <div class="doctor-info">
                    <h2 class="section-title">About Dr. Smith</h2>
                    <div class="doctor-info-content">
                        <img src="https://via.placeholder.com/150" alt="Dr. Smith" id="doctorPhoto">
                        <p>Dr. Jonathan Smith is a board-certified orthopedic specialist with over 15 years of experience in treating various musculoskeletal conditions. He received his medical degree from Harvard Medical School and completed his residency at Johns Hopkins Hospital.</p>
                        <p>Specializing in sports medicine and joint rehabilitation, Dr. Smith has helped countless patients regain mobility and return to their active lifestyles. His approach combines cutting-edge techniques with personalized care plans tailored to each patient's specific needs.</p>
                        <p>Dr. Smith is committed to continuous education and stays updated with the latest advancements in orthopedic care. He regularly publishes research papers and participates in international medical conferences.</p>
                    </div>
                </div>
                
                <div class="status-card hidden" id="patientStatusCard">
                    <h2 class="section-title">Your Current Status</h2>
                    <div class="status-label status-pending" id="statusLabel">Pending Appointment</div>
                    <p id="statusDescription">You have requested an appointment and are waiting for confirmation from Dr. Smith.</p>
                    
                    <h3 style="margin-top: 1.5rem; color: #4a5568; font-size: 1.2rem;">Upcoming Appointments</h3>
                    <ul class="appointment-list" id="upcomingAppointmentsList">
                        <!-- Appointments will be populated here -->
                    </ul>
                    
                    <div class="treatment-details hidden" id="treatmentDetails">
                        <h3>Treatment Information</h3>
                        <p id="doctorRecommendations"><strong>Doctor's Recommendations:</strong> Not available yet</p>
                        <p id="subscriptionDetails"><strong>Subscription Details:</strong> Not available yet</p>
                    </div>
                </div>
            </div>
            
            <div class="sidebar">
                <div class="location-info">
                    <h2 class="section-title">Our Location</h2>
                    <iframe src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3024.2219901290355!2d-74.00369368400567!3d40.71277447933185!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x89c25a23e28c1191%3A0x49f75d3281df052a!2s150%20Park%20Row%2C%20New%20York%2C%20NY%2010007%2C%20USA!5e0!3m2!1sen!2s!4v1614352456475!5m2!1sen!2s" 
                            class="location-map" 
                            style="border:0;" 
                            allowfullscreen="" 
                            loading="lazy">
                    </iframe>
                    <p><strong>Address:</strong> 150 Park Row, New York, NY 10007</p>
                    <p><strong>Phone:</strong> (212) 555-1234</p>
                    <p><strong>Hours:</strong> Monday-Friday, 9AM-5PM</p>
                </div>
                
                <div class="appointment-card">
                    <h2 class="section-title">Need Help?</h2>
                    <p>If you're experiencing orthopedic issues or have questions about treatment options, don't hesitate to schedule a consultation with Dr. Smith.</p>
                    <button class="btn" style="width: 100%; margin-top: 1rem;" id="helpAppointmentBtn">Book Now</button>
                </div>
            </div>
        </div>
        
        <!-- Appointment Booking Form -->
        <div class="form-container" id="appointmentForm">
            <h2>Book Your Appointment</h2>
            <div class="form-group">
                <label for="medicalIssue">Current Medical Issue</label>
                <textarea id="medicalIssue" name="medicalIssue" placeholder="Describe your current medical issue"></textarea>
            </div>
            <div class="form-group">
                <label for="issueStartDate">When did the issue start?</label>
                <input type="date" id="issueStartDate" name="issueStartDate">
            </div>
            <div class="form-group">
                <label for="previousProblems">Any previous related health problems?</label>
                <textarea id="previousProblems" name="previousProblems" placeholder="Describe any previous related health problems"></textarea>
            </div>
            <div class="form-group">
                <label>Please select three preferred appointment slots:</label>
                <p style="color: #4a5568; font-size: 0.875rem; margin-bottom: 0.5rem;">Click to select up to 3 time slots</p>
                <div class="slot-selection" id="slotSelection">
                    <!-- Available slots will be populated here -->
                </div>
                <div class="hidden error-message" id="slotError" style="color: #e53e3e; margin-top: 0.5rem;">Please select exactly 3 time slots.</div>
            </div>
            <div class="form-actions">
                <button class="btn" style="background-color: #718096;" id="cancelAppointmentBtn">Cancel</button>
                <button class="btn" id="submitAppointmentBtn">Submit Request</button>
            </div>
        </div>
    </div>

    <script>
        // DOM Elements
        const patientNameEl = document.getElementById('patientName');
        const statusLabelEl = document.getElementById('statusLabel');
        const statusDescriptionEl = document.getElementById('statusDescription');
        const upcomingAppointmentsListEl = document.getElementById('upcomingAppointmentsList');
        const patientStatusCardEl = document.getElementById('patientStatusCard');
        const treatmentDetailsEl = document.getElementById('treatmentDetails');
        const doctorRecommendationsEl = document.getElementById('doctorRecommendations');
        const subscriptionDetailsEl = document.getElementById('subscriptionDetails');
        const slotSelectionEl = document.getElementById('slotSelection');
        
        // Check if user is logged in
        document.addEventListener('DOMContentLoaded', () => {
            const currentPatient = JSON.parse(localStorage.getItem('currentPatient'));
            
            if (!currentPatient) {
                // Redirect to login page if not logged in
                window.location.href = 'index.html';
                return;
            }
            
            // Update UI with patient name
            patientNameEl.textContent = currentPatient.name;
            
            // Check if patient has appointments
            if (currentPatient.appointments && currentPatient.appointments.length > 0) {
                patientStatusCardEl.classList.remove('hidden');
                updatePatientStatus(currentPatient);
                updateAppointmentsList(currentPatient);
            }
            
            // Generate available time slots
            generateTimeSlots();
        });
        
        // Logout button
        document.getElementById('logoutBtn').addEventListener('click', () => {
            localStorage.removeItem('currentPatient');
            window.location.href = 'index.html';
        });
        
        // Book Appointment button click handlers
        document.getElementById('bookAppointmentBtn').addEventListener('click', (e) => {
            e.preventDefault();
            document.getElementById('appointmentForm').style.display = 'block';
            window.scrollTo(0, document.getElementById('appointmentForm').offsetTop - 20);
        });
        
        document.getElementById('helpAppointmentBtn').addEventListener('click', () => {
            document.getElementById('appointmentForm').style.display = 'block';
            window.scrollTo(0, document.getElementById('appointmentForm').offsetTop - 20);
        });
        
        document.getElementById('cancelAppointmentBtn').addEventListener('click', () => {
            document.getElementById('appointmentForm').style.display = 'none';
            // Reset form
            document.getElementById('medicalIssue').value = '';
            document.getElementById('issueStartDate').value = '';
            document.getElementById('previousProblems').value = '';
            const slots = document.querySelectorAll('.slot-option');
            slots.forEach(slot => slot.classList.remove('selected'));
        });
        
        // Update patient status based on appointment status
        function updatePatientStatus(patient) {
            let latestStatus = 'pending';
            let statusText = 'You have requested an appointment and are waiting for confirmation from Dr. Smith.';
            
            // Find the latest appointment status
            if (patient.appointments && patient.appointments.length > 0) {
                // Sort appointments by date (newest first)
                const sortedAppointments = [...patient.appointments].sort((a, b) => {
                    return new Date(b.date) - new Date(a.date);
                });
                
                const latestAppointment = sortedAppointments[0];
                latestStatus = latestAppointment.status;
                
                // Set status text based on status
                switch (latestStatus) {
                    case 'pending':
                        statusText = 'You have requested an appointment and are waiting for confirmation from Dr. Smith.';
                        break;
                    case 'upcoming':
                        statusText = `Your appointment has been confirmed for ${formatDate(latestAppointment.confirmedSlot)}.`;
                        break;
                    case 'in-treatment':
                        statusText = 'You are currently under treatment with Dr. Smith.';
                        treatmentDetailsEl.classList.remove('hidden');
                        if (latestAppointment.doctorRecommendations) {
                            doctorRecommendationsEl.innerHTML = `<strong>Doctor's Recommendations:</strong> ${latestAppointment.doctorRecommendations}`;
                        }
                        if (latestAppointment.subscriptionDetails) {
                            subscriptionDetailsEl.innerHTML = `<strong>Subscription Details:</strong> ${latestAppointment.subscriptionDetails}`;
                        }
                        break;
                    case 'treated':
                        statusText = 'You have completed your treatment with Dr. Smith.';
                        treatmentDetailsEl.classList.remove('hidden');
                        if (latestAppointment.doctorRecommendations) {
                            doctorRecommendationsEl.innerHTML = `<strong>Doctor's Recommendations:</strong> ${latestAppointment.doctorRecommendations}`;
                        }
                        if (latestAppointment.subscriptionDetails) {
                            subscriptionDetailsEl.innerHTML = `<strong>Subscription Details:</strong> ${latestAppointment.subscriptionDetails}`;
                        }
                        break;
                }
            }
            
            // Update UI
            statusLabelEl.className = 'status-label';
            statusLabelEl.classList.add(`status-${latestStatus}`);
            
            // Capitalize first letter of status
            statusLabelEl.textContent = latestStatus.charAt(0).toUpperCase() + latestStatus.slice(1);
            statusDescriptionEl.textContent = statusText;
        }
        
        // Update appointments list
        function updateAppointmentsList(patient) {
            if (!patient.appointments || patient.appointments.length === 0) {
                upcomingAppointmentsListEl.innerHTML = '<li>No upcoming appointments</li>';
                return;
            }
            
            // Filter and sort upcoming appointments
            const upcomingAppointments = patient.appointments
                .filter(app => app.status === 'upcoming' || app.status === 'pending')
                .sort((a, b) => {
                    const dateA = a.confirmedSlot ? new Date(a.confirmedSlot) : new Date(a.requestDate);
                    const dateB = b.confirmedSlot ? new Date(b.confirmedSlot) : new Date(b.requestDate);
                    return dateA - dateB;
                });
            
            if (upcomingAppointments.length === 0) {
                upcomingAppointmentsListEl.innerHTML = '<li>No upcoming appointments</li>';
                return;
            }
            
            // Generate list items
            upcomingAppointmentsListEl.innerHTML = '';
            upcomingAppointments.forEach(appointment => {
                const li = document.createElement('li');
                li.className = 'appointment-item';
                
                let dateText = '';
                if (appointment.status === 'pending') {
                    dateText = `Requested on: ${formatDate(appointment.requestDate)}`;
                } else if (appointment.status === 'upcoming') {
                    dateText = `Scheduled for: ${formatDate(appointment.confirmedSlot)}`;
                }
                
                li.innerHTML = `
                    <div class="appointment-date">${dateText}</div>
                    <div><strong>Medical Issue:</strong> ${appointment.medicalIssue}</div>
                    <div><strong>Status:</strong> ${appointment.status === 'pending' ? 'Waiting for confirmation' : 'Confirmed'}</div>
                `;
                
                upcomingAppointmentsListEl.appendChild(li);
            });
        }
        
        // Generate time slots for appointment booking
        function generateTimeSlots() {
            // Get working hours from localStorage
            const workingHours = JSON.parse(localStorage.getItem('workingHours') || '[]');
            
            // Get booked appointments
            let bookedAppointments = [];
            const patients = JSON.parse(localStorage.getItem('patients') || '[]');
            patients.forEach(patient => {
                if (patient.appointments) {
                    patient.appointments.forEach(app => {
                        if (app.confirmedSlot) {
                            bookedAppointments.push(app.confirmedSlot);
                        }
                    });
                }
            });
            
            // Generate time slots for the next 14 days
            const slots = [];
            const today = new Date();
            
            for (let i = 1; i <= 14; i++) {
                const date = new Date(today);
                date.setDate(today.getDate() + i);
                
                // Skip weekends (0 = Sunday, 6 = Saturday)
                const day = date.getDay();
                if (day === 0 || day === 6) continue;
                
                // Generate slots for this day
                const workingHoursForDay = workingHours.find(wh => wh.day === getDayName(day));
                
                if (workingHoursForDay && workingHoursForDay.isWorking) {
                    const startTime = parseInt(workingHoursForDay.startTime.split(':')[0]);
                    const endTime = parseInt(workingHoursForDay.endTime.split(':')[0]);
                    
                    // Generate hourly slots
                    for (let hour = startTime; hour < endTime; hour++) {
                        const slotTime = new Date(date);
                        slotTime.setHours(hour, 0, 0, 0);
                        
                        // Format as ISO string for comparison
                        const slotTimeString = slotTime.toISOString();
                        
                        // Check if slot is already booked
                        if (!bookedAppointments.includes(slotTimeString)) {
                            slots.push({
                                time: slotTimeString,
                                display: `${formatDate(slotTimeString)} - ${hour}:00`
                            });
                        }
                    }
                }
            }
            
            // If no working hours are set, generate default slots
            if (slots.length === 0) {
                for (let i = 1; i <= 14; i++) {
                    const date = new Date(today);
                    date.setDate(today.getDate() + i);
                    
                    // Skip weekends
                    const day = date.getDay();
                    if (day === 0 || day === 6) continue;
                    
                    // Generate default slots (9 AM to 5 PM)
                    for (let hour = 9; hour < 17; hour++) {
                        const slotTime = new Date(date);
                        slotTime.setHours(hour, 0, 0, 0);
                        
                        slots.push({
                            time: slotTime.toISOString(),
                            display: `${formatDate(slotTime.toISOString())} - ${hour}:00`
                        });
                    }
                }
            }
            
            // Update UI with available slots
            const slotSelectionEl = document.getElementById('slotSelection');
            slotSelectionEl.innerHTML = '';
            
            // Display up to 15 slots to avoid overwhelming the user
            const slotsToShow = slots.slice(0, 15);
            
            slotsToShow.forEach(slot => {
                const slotEl = document.createElement('div');
                slotEl.className = 'slot-option';
                slotEl.setAttribute('data-time', slot.time);
                slotEl.textContent = slot.display;
                
                // Add click event to toggle selection
                slotEl.addEventListener('click', () => {
                    const selectedSlots = document.querySelectorAll('.slot-option.selected');
                    
                    if (slotEl.classList.contains('selected')) {
                        // Deselect
                        slotEl.classList.remove('selected');
                    } else if (selectedSlots.length < 3) {
                        // Select if less than 3 are already selected
                        slotEl.classList.add('selected');
                    }
                    
                    // Hide error message when selection changes
                    document.getElementById('slotError').classList.add('hidden');
                });
                
                slotSelectionEl.appendChild(slotEl);
            });
            
            // If no slots are available, show message
            if (slotsToShow.length === 0) {
                slotSelectionEl.innerHTML = '<p>No available slots. Please try again later.</p>';
                document.getElementById('submitAppointmentBtn').disabled = true;
            } else {
                document.getElementById('submitAppointmentBtn').disabled = false;
            }
        }
        
        // Submit appointment request
        document.getElementById('submitAppointmentBtn').addEventListener('click', () => {
            // Get form values
            const medicalIssue = document.getElementById('medicalIssue').value;
            const issueStartDate = document.getElementById('issueStartDate').value;
            const previousProblems = document.getElementById('previousProblems').value;
            
            // Get selected time slots
            const selectedSlots = document.querySelectorAll('.slot-option.selected');
            const selectedTimes = Array.from(selectedSlots).map(slot => slot.getAttribute('data-time'));
            
            // Validate form
            if (!medicalIssue || !issueStartDate) {
                alert('Please fill in all required fields');
                return;
            }
            
            if (selectedTimes.length !== 3) {
                document.getElementById('slotError').classList.remove('hidden');
                return;
            }
            
            // Create appointment object
            const appointment = {
                id: Date.now().toString(),
                medicalIssue,
                issueStartDate,
                previousProblems,
                requestDate: new Date().toISOString(),
                preferredSlots: selectedTimes,
                status: 'pending',
                confirmedSlot: null,
                doctorRecommendations: null,
                subscriptionDetails: null
            };
            
            // Get current patient
            const currentPatient = JSON.parse(localStorage.getItem('currentPatient'));
            
            // Add new appointment
            if (!currentPatient.appointments) {
                currentPatient.appointments = [];
            }
            currentPatient.appointments.push(appointment);
            
            // Update localStorage
            localStorage.setItem('currentPatient', JSON.stringify(currentPatient));
            
            // Update patients array
            const patients = JSON.parse(localStorage.getItem('patients') || '[]');
            const patientIndex = patients.findIndex(p => p.email === currentPatient.email);
            
            if (patientIndex !== -1) {
                patients[patientIndex] = currentPatient;
                localStorage.setItem('patients', JSON.stringify(patients));
            }
            
            // Update UI
            patientStatusCardEl.classList.remove('hidden');
            updatePatientStatus(currentPatient);
            updateAppointmentsList(currentPatient);
            
            // Hide form and show success message
            document.getElementById('appointmentForm').style.display = 'none';
            alert('Your appointment request has been submitted. Dr. Smith will review your preferred times and confirm one of them soon.');
            
            // Reset form
            document.getElementById('medicalIssue').value = '';
            document.getElementById('issueStartDate').value = '';
            document.getElementById('previousProblems').value = '';
            selectedSlots.forEach(slot => slot.classList.remove('selected'));
        });
        
        // Helper functions
        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('en-US', { 
                weekday: 'short', 
                month: 'short', 
                day: 'numeric',
                year: 'numeric'
            });
        }
        
        function getDayName(dayIndex) {
            const days = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
            return days[dayIndex];
        }
        
       
            // Navigation links
document.getElementById('appointmentsLink').addEventListener('click', (e) => {
    e.preventDefault();
    // Show appointments section
    patientStatusCardEl.classList.remove('hidden');
    window.scrollTo(0, patientStatusCardEl.offsetTop - 20);
    
    // Update active link
    document.querySelectorAll('.nav-link').forEach(link => link.classList.remove('active'));
    document.getElementById('appointmentsLink').classList.add('active');
});

document.getElementById('treatmentLink').addEventListener('click', (e) => {
    e.preventDefault();
    
    // Show treatment details if available
    const currentPatient = JSON.parse(localStorage.getItem('currentPatient'));
    if (currentPatient && currentPatient.appointments) {
        const inTreatmentAppointments = currentPatient.appointments.filter(
            app => app.status === 'in-treatment' || app.status === 'treated'
        );
        
        if (inTreatmentAppointments.length > 0) {
            patientStatusCardEl.classList.remove('hidden');
            treatmentDetailsEl.classList.remove('hidden');
            window.scrollTo(0, treatmentDetailsEl.offsetTop - 20);
        } else {
            alert('You do not have any active treatments yet.');
        }
    } else {
        alert('You do not have any active treatments yet.');
    }
    
    // Update active link
    document.querySelectorAll('.nav-link').forEach(link => link.classList.remove('active'));
    document.getElementById('treatmentLink').classList.add('active');
});

// Home link
document.querySelector('.nav-link.active').addEventListener('click', (e) => {
    e.preventDefault();
    // Scroll to top
    window.scrollTo(0, 0);
    
    // Update active link
    document.querySelectorAll('.nav-link').forEach(link => link.classList.remove('active'));
    e.target.classList.add('active');
});